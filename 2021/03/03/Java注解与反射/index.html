<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="Java SE: Annotation &amp; Reflection注解什么是注解 Java SE 5.0引入 区别于注释comment，注释的使用对象是人，注解的使用对象同时有人和编译器 格式：**”@注解名(参数&#x3D;”值”)”**在代码中存在，可以添加参数 可以附加在package，class，method，field等上面，相当于添加辅助信息，可以通过反射机制编程实现对这些数据的访问  内">
<meta property="og:type" content="article">
<meta property="og:title" content="Java注解与反射">
<meta property="og:url" content="https://readchart.github.io/2021/03/03/Java%E6%B3%A8%E8%A7%A3%E4%B8%8E%E5%8F%8D%E5%B0%84/index.html">
<meta property="og:site_name" content="记仇日记">
<meta property="og:description" content="Java SE: Annotation &amp; Reflection注解什么是注解 Java SE 5.0引入 区别于注释comment，注释的使用对象是人，注解的使用对象同时有人和编译器 格式：**”@注解名(参数&#x3D;”值”)”**在代码中存在，可以添加参数 可以附加在package，class，method，field等上面，相当于添加辅助信息，可以通过反射机制编程实现对这些数据的访问  内">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://i.imgur.com/BynAsxL.png">
<meta property="og:image" content="https://i.imgur.com/wEyTOiL.png">
<meta property="og:image" content="https://i.imgur.com/lhvu05w.png">
<meta property="og:image" content="https://i.imgur.com/2yV9miO.png">
<meta property="article:published_time" content="2021-03-03T01:26:49.000Z">
<meta property="article:modified_time" content="2021-03-03T01:26:49.000Z">
<meta property="article:author" content="Richard T">
<meta property="article:tag" content="Java 基础">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.imgur.com/BynAsxL.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>Java注解与反射</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
      
<link rel="stylesheet" href="/css/rtl.css">

    
    <!-- rss -->
    
    
<meta name="generator" content="Hexo 5.4.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a target="_blank" rel="noopener" href="http://github.com/ReadChart">Projects</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2021/04/06/MySQL%E6%8A%80%E6%9C%AF%E5%86%85%E5%B9%95%EF%BC%9AInnoDB%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2021/02/10/Git%E6%B8%85%E9%99%A4%E6%8C%87%E5%AE%9A%E6%96%87%E4%BB%B6%E8%AE%B0%E5%BD%95/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://readchart.github.io/2021/03/03/Java%E6%B3%A8%E8%A7%A3%E4%B8%8E%E5%8F%8D%E5%B0%84/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://readchart.github.io/2021/03/03/Java%E6%B3%A8%E8%A7%A3%E4%B8%8E%E5%8F%8D%E5%B0%84/&text=Java注解与反射"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://readchart.github.io/2021/03/03/Java%E6%B3%A8%E8%A7%A3%E4%B8%8E%E5%8F%8D%E5%B0%84/&title=Java注解与反射"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://readchart.github.io/2021/03/03/Java%E6%B3%A8%E8%A7%A3%E4%B8%8E%E5%8F%8D%E5%B0%84/&is_video=false&description=Java注解与反射"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Java注解与反射&body=Check out this article: https://readchart.github.io/2021/03/03/Java%E6%B3%A8%E8%A7%A3%E4%B8%8E%E5%8F%8D%E5%B0%84/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://readchart.github.io/2021/03/03/Java%E6%B3%A8%E8%A7%A3%E4%B8%8E%E5%8F%8D%E5%B0%84/&title=Java注解与反射"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://readchart.github.io/2021/03/03/Java%E6%B3%A8%E8%A7%A3%E4%B8%8E%E5%8F%8D%E5%B0%84/&title=Java注解与反射"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://readchart.github.io/2021/03/03/Java%E6%B3%A8%E8%A7%A3%E4%B8%8E%E5%8F%8D%E5%B0%84/&title=Java注解与反射"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://readchart.github.io/2021/03/03/Java%E6%B3%A8%E8%A7%A3%E4%B8%8E%E5%8F%8D%E5%B0%84/&title=Java注解与反射"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://readchart.github.io/2021/03/03/Java%E6%B3%A8%E8%A7%A3%E4%B8%8E%E5%8F%8D%E5%B0%84/&name=Java注解与反射&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://readchart.github.io/2021/03/03/Java%E6%B3%A8%E8%A7%A3%E4%B8%8E%E5%8F%8D%E5%B0%84/&t=Java注解与反射"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Java-SE-Annotation-amp-Reflection"><span class="toc-number">1.</span> <span class="toc-text">Java SE: Annotation &amp; Reflection</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3"><span class="toc-number"></span> <span class="toc-text">注解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.</span> <span class="toc-text">什么是注解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E7%BD%AE%E6%B3%A8%E8%A7%A3"><span class="toc-number">2.</span> <span class="toc-text">内置注解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%83%E6%B3%A8%E8%A7%A3"><span class="toc-number">3.</span> <span class="toc-text">元注解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3"><span class="toc-number">4.</span> <span class="toc-text">自定义注解</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8D%E5%B0%84"><span class="toc-number"></span> <span class="toc-text">反射</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%8F%8D%E5%B0%84"><span class="toc-number">1.</span> <span class="toc-text">什么是反射</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E5%BA%94%E7%94%A8"><span class="toc-number">2.</span> <span class="toc-text">简单应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-number">3.</span> <span class="toc-text">优缺点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E5%B0%84%E7%9B%B8%E5%85%B3%E7%9A%84%E4%B8%BB%E8%A6%81Api"><span class="toc-number">4.</span> <span class="toc-text">反射相关的主要Api</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Class%E7%B1%BB"><span class="toc-number">5.</span> <span class="toc-text">Class类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%93%AA%E4%BA%9B%E7%B1%BB%E5%9E%8B%E5%8F%AF%E4%BB%A5%E6%9C%89Class%E5%AF%B9%E8%B1%A1%EF%BC%9F"><span class="toc-number">5.1.</span> <span class="toc-text">哪些类型可以有Class对象？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#getClass"><span class="toc-number">5.2.</span> <span class="toc-text">getClass()</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Java%E5%86%85%E5%AD%98%E5%88%86%E6%9E%90"><span class="toc-number"></span> <span class="toc-text">Java内存分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Java%E5%86%85%E5%AD%98"><span class="toc-number">1.</span> <span class="toc-text">Java内存</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A0%86"><span class="toc-number">1.1.</span> <span class="toc-text">堆</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%88"><span class="toc-number">1.2.</span> <span class="toc-text">栈</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E5%8C%BA"><span class="toc-number">1.3.</span> <span class="toc-text">方法区</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B1%BB%E7%9A%84%E5%8A%A0%E8%BD%BD%E8%BF%87%E7%A8%8B"><span class="toc-number"></span> <span class="toc-text">类的加载过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E4%BC%9A%E5%8F%91%E7%94%9F%E7%B1%BB%E7%9A%84%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number"></span> <span class="toc-text">什么时候会发生类的初始化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E7%9A%84%E4%B8%BB%E5%8A%A8%E5%BC%95%E7%94%A8-%E4%B8%80%E5%AE%9A%E4%BC%9A%E5%8F%91%E7%94%9F%E7%B1%BB%E7%9A%84%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">1.</span> <span class="toc-text">类的主动引用(一定会发生类的初始化)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E7%9A%84%E8%A2%AB%E5%8A%A8%E5%BC%95%E7%94%A8-%E4%B8%8D%E4%BC%9A%E5%8F%91%E7%94%9F%E7%B1%BB%E7%9A%84%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">2.</span> <span class="toc-text">类的被动引用(不会发生类的初始化)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number"></span> <span class="toc-text">类加载器的作用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E5%8A%A0%E8%BD%BD%E7%9A%84%E4%BD%9C%E7%94%A8%EF%BC%9A"><span class="toc-number">1.</span> <span class="toc-text">类加载的作用：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E7%BC%93%E5%AD%98%EF%BC%9A"><span class="toc-number">2.</span> <span class="toc-text">类缓存：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Run-time-Built-in-Class-Loaders"><span class="toc-number">3.</span> <span class="toc-text">Run-time Built-in Class Loaders</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#New-Class-Loader-Implementations"><span class="toc-number">4.</span> <span class="toc-text">New Class Loader Implementations</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E8%BF%90%E8%A1%8C%E6%97%B6%E7%B1%BB%E7%9A%84%E5%AE%8C%E6%95%B4%E7%BB%93%E6%9E%84"><span class="toc-number"></span> <span class="toc-text">获取运行时类的完整结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E5%8F%8D%E5%B0%84%E8%8E%B7%E5%8F%96%E8%BF%90%E8%A1%8C%E6%97%B6%E7%B1%BB%E7%9A%84%E5%AE%8C%E6%95%B4%E7%BB%93%E6%9E%84%EF%BC%9A"><span class="toc-number">1.</span> <span class="toc-text">通过反射获取运行时类的完整结构：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93%EF%BC%9A"><span class="toc-number">2.</span> <span class="toc-text">小结：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%89%E4%BA%86Class%E5%AF%B9%E8%B1%A1%EF%BC%8C%E8%83%BD%E5%81%9A%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number"></span> <span class="toc-text">有了Class对象，能做什么？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%83%E7%94%A8%E5%88%B6%E5%AE%9A%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-number">1.</span> <span class="toc-text">调用制定的方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8D%E5%B0%84%E6%93%8D%E4%BD%9C%E6%B3%9B%E5%9E%8B"><span class="toc-number"></span> <span class="toc-text">反射操作泛型</span></a>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Java注解与反射
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">记仇日记</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2021-03-03T01:26:49.000Z" itemprop="datePublished">2021-03-03</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/Java-%E5%9F%BA%E7%A1%80/" rel="tag">Java 基础</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h3 id="Java-SE-Annotation-amp-Reflection"><a href="#Java-SE-Annotation-amp-Reflection" class="headerlink" title="Java SE: Annotation &amp; Reflection"></a><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1p4411P7V3">Java SE: Annotation &amp; Reflection</a></h3><h2 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h2><h3 id="什么是注解"><a href="#什么是注解" class="headerlink" title="什么是注解"></a>什么是注解</h3><ol>
<li>Java SE 5.0引入</li>
<li>区别于<code>注释</code><em>comment</em>，注释的使用对象是人，注解的使用对象同时有人和编译器</li>
<li>格式：**”@注解名(参数=”值”)”**在代码中存在，可以添加参数</li>
<li>可以附加在package，class，method，field等上面，相当于添加辅助信息，可以通过反射机制编程实现对这些数据的访问</li>
</ol>
<h3 id="内置注解"><a href="#内置注解" class="headerlink" title="内置注解"></a>内置注解</h3><ul>
<li><code>@Override</code>：定义在 package java.lang.Override中，此注解只适用于修辞方法，表示此方法打算重写超类中一个相同的方法的声明。</li>
<li><code>@Deprecated</code>：定义在 package java.lang.Deprecated中，此注解可以用于修辞方法、属性、类，表示不太推荐使用，可能存在风险或者有更好的选择</li>
<li><code>@SuppressWarnings</code>：定义在 package java.lang.SuppressWarnings中，用于程序在编译时抑制警告信息（此注解必须配合参数）</li>
</ul>
<h3 id="元注解"><a href="#元注解" class="headerlink" title="元注解"></a>元注解</h3><ul>
<li><p>元注解的作用就是负责注解其他注解，Java定义了4个标准的meta-annotation类型，它们被用来提供对其他的annotation类型做说明</p>
</li>
<li><p>这些类型和他们所支持的类在java.lang.annotation包中可以找到(@Target, @Retention, @Documented, @Inherited )</p>
<ul>
<li><p><code>@Target</code>：用于描述注解的适用范围，</p>
<ul>
<li>TYPE：类、接口（包括注解类型）、枚举声明</li>
<li>FIELD：声明成员变量（包括枚举常量）</li>
<li>METHOD：方法声明</li>
<li>PARAMETER：常规参数声明</li>
<li>CONSTRUCTOR：构造函数声明</li>
<li>LOCAL_VARIBLE：内部变量声明</li>
<li>ANNOTATION_TYPE：注解类型声明（自定义元注解）</li>
<li>PACKAGE：包声明</li>
<li>TYPE_PARAMETER：类型参数声明</li>
<li>TYPE_USE：类型的使用</li>
</ul>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(ElementType.ANNOTATION_TYPE)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Target &#123;</span><br><span class="line">     ElementType[] value();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">ElementType</span> </span>&#123;</span><br><span class="line">    <span class="comment">/** Class, interface (including annotation type), or enum declaration */</span></span><br><span class="line">    TYPE,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Field declaration (includes enum constants) */</span></span><br><span class="line">    FIELD,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Method declaration */</span></span><br><span class="line">    METHOD,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Formal parameter declaration */</span></span><br><span class="line">    PARAMETER,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Constructor declaration */</span></span><br><span class="line">    CONSTRUCTOR,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Local variable declaration */</span></span><br><span class="line">    LOCAL_VARIABLE,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Annotation type declaration */</span></span><br><span class="line">    ANNOTATION_TYPE,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Package declaration */</span></span><br><span class="line">    PACKAGE,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Type parameter declaration</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.8</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@hide</span> 1.8</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    TYPE_PARAMETER,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Use of a type</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.8</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@hide</span> 1.8</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    TYPE_USE</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p><code>@Retention</code>：表示需要在什么级别保存该注释信息，用于描述注解的生命周期</p>
<ul>
<li>(Source &lt; Class &lt; Runtime)</li>
<li>Source：编译程序处理完注解信息后丢弃</li>
<li>Class：编译程序处理完注解信息后存储在class中，默认情况下采取此policy</li>
<li>Runtime：编译程序处理完注解信息后存储在class中，可由VM读入</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(ElementType.ANNOTATION_TYPE)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Retention &#123;</span><br><span class="line"> <span class="function">RetentionPolicy <span class="title">value</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">RetentionPolicy</span> </span>&#123;</span><br><span class="line"> 	<span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Annotations are to be discarded by the compiler.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    SOURCE,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Annotations are to be recorded in the class file by the compiler</span></span><br><span class="line"><span class="comment">     * but need not be retained by the VM at run time.  This is the default</span></span><br><span class="line"><span class="comment">     * behavior.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    CLASS,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Annotations are to be recorded in the class file by the compiler and</span></span><br><span class="line"><span class="comment">     * retained by the VM at run time, so they may be read reflectively.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> java.lang.reflect.AnnotatedElement</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    RUNTIME</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p><code>@Documented</code>：说明该注解将包含在javadoc中</p>
</li>
<li><p><code>@Inherited</code>：说明子类可以继承父类中的该注解</p>
</li>
</ul>
</li>
</ul>
<h3 id="自定义注解"><a href="#自定义注解" class="headerlink" title="自定义注解"></a>自定义注解</h3><ul>
<li>使用<code>@interface</code>自定义注解时，自动继承了java.lang.Annotation接口</li>
<li>分析：<ul>
<li>@interface用来声明一个注解，格式：public @interface 注解名{定义内容}</li>
<li>其中的每一个方法实际上是声明了一个配置参数</li>
<li>方法的名称就是参数的名称</li>
<li>返回值的类型就是参数的类型（返回值只能是基本类型，Class, String, enum）</li>
<li>可以通过default来声明参数的默认值</li>
<li>如果只有一个参数成员，一般参数名用value</li>
<li>注解元素必须要有值，我们定义注解元素时，经常使用空字符串，0作为默认值</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAnnotation</span></span>&#123;</span><br><span class="line">    <span class="meta">@Target(ElementType.TYPE, ElementType.METHOD)</span></span><br><span class="line">    <span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line">    <span class="meta">@Interface</span> MyAnno1&#123;</span><br><span class="line">        <span class="function">String <span class="title">name</span><span class="params">()</span> <span class="keyword">default</span> &quot;<span class="keyword">null</span>&quot;</span>;</span><br><span class="line">        <span class="function"><span class="keyword">int</span> <span class="title">age</span><span class="params">()</span> <span class="keyword">default</span> 0</span>;</span><br><span class="line">        String[] stringArr() <span class="keyword">default</span> &#123;<span class="string">&quot;Item1&quot;</span>, <span class="string">&quot;Item2&quot;</span>&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="反射"><a href="#反射" class="headerlink" title="反射"></a>反射</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Copyright (c) 2001, 2019, Oracle and/or its affiliates. All rights reserved.</span></span><br><span class="line"><span class="comment"> * ORACLE PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> jdk.internal.reflect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.*;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"><span class="keyword">import</span> jdk.internal.HotSpotIntrinsicCandidate;</span><br><span class="line"><span class="keyword">import</span> jdk.internal.misc.VM;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Common utility routines used by both java.lang and</span></span><br><span class="line"><span class="comment">    java.lang.reflect */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Reflection</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Used to filter out fields and methods from certain classes from public</span></span><br><span class="line"><span class="comment">        view, where they are sensitive or they may contain VM-internal objects.</span></span><br><span class="line"><span class="comment">        These Maps are updated very rarely. Rather than synchronize on</span></span><br><span class="line"><span class="comment">        each access, we use copy-on-write */</span></span><br><span class="line">    <span class="comment">/* Copy-On-Write是一个容器简称COW，是一种用于程序设计中的优化策略。</span></span><br><span class="line"><span class="comment">    基本思路：</span></span><br><span class="line"><span class="comment">    从一开始大家都在共享同一个内容，当某个人想要修改这个内容的时候，才会真正把内容copy出去形成一个新的内容然后再改，这是一个延时懒惰策略。</span></span><br><span class="line"><span class="comment">    从JDK1.5开始Java并发包里提供两个Copy-On-Write机制的并发容器，分别是CopyOnWriteArrayList和CopyOnWriteArraySet。</span></span><br><span class="line"><span class="comment">    优势：无需加锁，因为当前容器不会添加任何新的元素。</span></span><br><span class="line"><span class="comment">    缺点：内存占用(读写的时候同时驻扎两个对象，占用内存较大，此时考虑压缩数据)和数据一致(只保证数据最终一致性，不保证过程中的一致性，即时读写不推荐使用)的问题</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> Map&lt;Class&lt;?&gt;, Set&lt;String&gt;&gt; fieldFilterMap;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> Map&lt;Class&lt;?&gt;, Set&lt;String&gt;&gt; methodFilterMap;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String WILDCARD = <span class="string">&quot;*&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Set&lt;String&gt; ALL_MEMBERS = Set.of(WILDCARD);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        fieldFilterMap = Map.of(</span><br><span class="line">            Reflection.class, ALL_MEMBERS,</span><br><span class="line">            AccessibleObject.class, ALL_MEMBERS,</span><br><span class="line">            Class.class, Set.of(<span class="string">&quot;classLoader&quot;</span>),</span><br><span class="line">            ClassLoader.class, ALL_MEMBERS,</span><br><span class="line">            Constructor.class, ALL_MEMBERS,</span><br><span class="line">            Field.class, ALL_MEMBERS,</span><br><span class="line">            Method.class, ALL_MEMBERS,</span><br><span class="line">            Module.class, ALL_MEMBERS,</span><br><span class="line">            System.class, Set.of(<span class="string">&quot;security&quot;</span>)</span><br><span class="line">        );</span><br><span class="line">        methodFilterMap = Map.of();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Returns the class of the caller of the method calling this method,</span></span><br><span class="line"><span class="comment">        ignoring frames associated with java.lang.reflect.Method.invoke()</span></span><br><span class="line"><span class="comment">        and its implementation. */</span></span><br><span class="line">    <span class="meta">@CallerSensitive</span></span><br><span class="line">    <span class="meta">@HotSpotIntrinsicCandidate</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> Class&lt;?&gt; getCallerClass();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Retrieves the access flags written to the class file. For</span></span><br><span class="line"><span class="comment">        inner classes these flags may differ from those returned by</span></span><br><span class="line"><span class="comment">        Class.getModifiers(), which searches the InnerClasses</span></span><br><span class="line"><span class="comment">        attribute to find the source-level access flags. This is used</span></span><br><span class="line"><span class="comment">        instead of Class.getModifiers() for run-time access checks due</span></span><br><span class="line"><span class="comment">        to compatibility reasons; see 4471811. Only the values of the</span></span><br><span class="line"><span class="comment">        low 13 bits (i.e., a mask of 0x1FFF) are guaranteed to be</span></span><br><span class="line"><span class="comment">        valid. */</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    出于兼容性原因Class.getModifiers()会在源码级别搜索InnerClass而不在运行时搜索。</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="meta">@HotSpotIntrinsicCandidate</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="keyword">int</span> <span class="title">getClassAccessFlags</span><span class="params">(Class&lt;?&gt; c)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Ensures that access to a member is granted and throws</span></span><br><span class="line"><span class="comment">     * IllegalAccessException if not.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> currentClass the class performing the access</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> memberClass the declaring class of the member being accessed</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> targetClass the class of target object if accessing instance</span></span><br><span class="line"><span class="comment">     *                    field or method;</span></span><br><span class="line"><span class="comment">     *                    or the declaring class if accessing constructor;</span></span><br><span class="line"><span class="comment">     *                    or null if accessing static field or method</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> modifiers the member&#x27;s access modifiers</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IllegalAccessException if access to member is denied</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ensureMemberAccess</span><span class="params">(Class&lt;?&gt; currentClass,</span></span></span><br><span class="line"><span class="params"><span class="function">                                          Class&lt;?&gt; memberClass,</span></span></span><br><span class="line"><span class="params"><span class="function">                                          Class&lt;?&gt; targetClass,</span></span></span><br><span class="line"><span class="params"><span class="function">                                          <span class="keyword">int</span> modifiers)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> IllegalAccessException </span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!verifyMemberAccess(currentClass, memberClass, targetClass, modifiers)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalAccessException(currentClass, memberClass, targetClass, modifiers);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Verify access to a member and return &#123;<span class="doctag">@code</span> true&#125; if it is granted.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> currentClass the class performing the access</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> memberClass the declaring class of the member being accessed</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> targetClass the class of target object if accessing instance</span></span><br><span class="line"><span class="comment">     *                    field or method;</span></span><br><span class="line"><span class="comment">     *                    or the declaring class if accessing constructor;</span></span><br><span class="line"><span class="comment">     *                    or null if accessing static field or method</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> modifiers the member&#x27;s access modifiers</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> &#123;<span class="doctag">@code</span> true&#125; if access to member is granted</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">verifyMemberAccess</span><span class="params">(Class&lt;?&gt; currentClass,</span></span></span><br><span class="line"><span class="params"><span class="function">                                             Class&lt;?&gt; memberClass,</span></span></span><br><span class="line"><span class="params"><span class="function">                                             Class&lt;?&gt; targetClass,</span></span></span><br><span class="line"><span class="params"><span class="function">                                             <span class="keyword">int</span> modifiers)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Objects.requireNonNull(currentClass);</span><br><span class="line">        Objects.requireNonNull(memberClass);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (currentClass == memberClass) &#123;</span><br><span class="line">            <span class="comment">// Always succeeds</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!verifyModuleAccess(currentClass.getModule(), memberClass)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">boolean</span> gotIsSameClassPackage = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">boolean</span> isSameClassPackage = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!Modifier.isPublic(getClassAccessFlags(memberClass))) &#123;</span><br><span class="line">            isSameClassPackage = isSameClassPackage(currentClass, memberClass);</span><br><span class="line">            gotIsSameClassPackage = <span class="keyword">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (!isSameClassPackage) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// At this point we know that currentClass can access memberClass.</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (Modifier.isPublic(modifiers)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Check for nestmate access if member is private</span></span><br><span class="line">        <span class="keyword">if</span> (Modifier.isPrivate(modifiers)) &#123;</span><br><span class="line">            <span class="comment">// Note: targetClass may be outside the nest, but that is okay</span></span><br><span class="line">            <span class="comment">//       as long as memberClass is in the nest.</span></span><br><span class="line">            <span class="keyword">if</span> (areNestMates(currentClass, memberClass)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">boolean</span> successSoFar = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (Modifier.isProtected(modifiers)) &#123;</span><br><span class="line">            <span class="comment">// See if currentClass is a subclass of memberClass</span></span><br><span class="line">            <span class="keyword">if</span> (isSubclassOf(currentClass, memberClass)) &#123;</span><br><span class="line">                successSoFar = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!successSoFar &amp;&amp; !Modifier.isPrivate(modifiers)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!gotIsSameClassPackage) &#123;</span><br><span class="line">                isSameClassPackage = isSameClassPackage(currentClass,</span><br><span class="line">                                                        memberClass);</span><br><span class="line">                gotIsSameClassPackage = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (isSameClassPackage) &#123;</span><br><span class="line">                successSoFar = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!successSoFar) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Additional test for protected instance members</span></span><br><span class="line">        <span class="comment">// and protected constructors: JLS 6.6.2</span></span><br><span class="line">        <span class="keyword">if</span> (targetClass != <span class="keyword">null</span> &amp;&amp; Modifier.isProtected(modifiers) &amp;&amp;</span><br><span class="line">            targetClass != currentClass)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (!gotIsSameClassPackage) &#123;</span><br><span class="line">                isSameClassPackage = isSameClassPackage(currentClass, memberClass);</span><br><span class="line">                gotIsSameClassPackage = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!isSameClassPackage) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!isSubclassOf(targetClass, currentClass)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * Verify if a member is public and memberClass is a public type</span></span><br><span class="line"><span class="comment">     * in a package that is unconditionally exported and</span></span><br><span class="line"><span class="comment">     * return &#123;@code true&#125;if it is granted.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @param memberClass the declaring class of the member being accessed</span></span><br><span class="line"><span class="comment">     * @param modifiers the member&#x27;s access modifiers</span></span><br><span class="line"><span class="comment">     * @return &#123;@code true&#125; if the member is public and in a publicly accessible type</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">verifyPublicMemberAccess</span><span class="params">(Class&lt;?&gt; memberClass, <span class="keyword">int</span> modifiers)</span> </span>&#123;</span><br><span class="line">        Module m = memberClass.getModule();</span><br><span class="line">        <span class="keyword">return</span> Modifier.isPublic(modifiers)</span><br><span class="line">            &amp;&amp; m.isExported(memberClass.getPackageName())</span><br><span class="line">            &amp;&amp; Modifier.isPublic(Reflection.getClassAccessFlags(memberClass));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns &#123;<span class="doctag">@code</span> true&#125; if memberClass&#x27;s module exports memberClass&#x27;s</span></span><br><span class="line"><span class="comment">     * package to currentModule.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">verifyModuleAccess</span><span class="params">(Module currentModule, Class&lt;?&gt; memberClass)</span> </span>&#123;</span><br><span class="line">        Module memberModule = memberClass.getModule();</span><br><span class="line">        <span class="keyword">if</span> (currentModule == memberModule) &#123;</span><br><span class="line">            <span class="comment">// same module (named or unnamed) or both null if called</span></span><br><span class="line">            <span class="comment">// before module system is initialized, which means we are</span></span><br><span class="line">            <span class="comment">// dealing with java.base only.</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            String pkg = memberClass.getPackageName();</span><br><span class="line">            <span class="keyword">return</span> memberModule.isExported(pkg, currentModule);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns true if two classes in the same package.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isSameClassPackage</span><span class="params">(Class&lt;?&gt; c1, Class&lt;?&gt; c2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (c1.getClassLoader() != c2.getClassLoader())</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">return</span> Objects.equals(c1.getPackageName(), c2.getPackageName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isSubclassOf</span><span class="params">(Class&lt;?&gt; queryClass,</span></span></span><br><span class="line"><span class="params"><span class="function">                                Class&lt;?&gt; ofClass)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (queryClass != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (queryClass == ofClass) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            queryClass = queryClass.getSuperclass();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// fieldNames must contain only interned Strings</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">registerFieldsToFilter</span><span class="params">(Class&lt;?&gt; containingClass,</span></span></span><br><span class="line"><span class="params"><span class="function">                                                           Set&lt;String&gt; fieldNames)</span> </span>&#123;</span><br><span class="line">        fieldFilterMap =</span><br><span class="line">            registerFilter(fieldFilterMap, containingClass, fieldNames);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// methodNames must contain only interned Strings</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">registerMethodsToFilter</span><span class="params">(Class&lt;?&gt; containingClass,</span></span></span><br><span class="line"><span class="params"><span class="function">                                                            Set&lt;String&gt; methodNames)</span> </span>&#123;</span><br><span class="line">        methodFilterMap =</span><br><span class="line">            registerFilter(methodFilterMap, containingClass, methodNames);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;Class&lt;?&gt;, Set&lt;String&gt;&gt; registerFilter(Map&lt;Class&lt;?&gt;, Set&lt;String&gt;&gt; map,</span><br><span class="line">                                                             Class&lt;?&gt; containingClass,</span><br><span class="line">                                                             Set&lt;String&gt; names) &#123;</span><br><span class="line">        <span class="keyword">if</span> (map.get(containingClass) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException</span><br><span class="line">                            (<span class="string">&quot;Filter already registered: &quot;</span> + containingClass);</span><br><span class="line">        &#125;</span><br><span class="line">        map = <span class="keyword">new</span> HashMap&lt;&gt;(map);</span><br><span class="line">        map.put(containingClass, Set.copyOf(names));</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Field[] filterFields(Class&lt;?&gt; containingClass, Field[] fields) &#123;</span><br><span class="line">        <span class="keyword">if</span> (fieldFilterMap == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// Bootstrapping</span></span><br><span class="line">            <span class="keyword">return</span> fields;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (Field[])filter(fields, fieldFilterMap.get(containingClass));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Method[] filterMethods(Class&lt;?&gt; containingClass, Method[] methods) &#123;</span><br><span class="line">        <span class="keyword">if</span> (methodFilterMap == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// Bootstrapping</span></span><br><span class="line">            <span class="keyword">return</span> methods;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (Method[])filter(methods, methodFilterMap.get(containingClass));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Member[] filter(Member[] members, Set&lt;String&gt; filteredNames) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((filteredNames == <span class="keyword">null</span>) || (members.length == <span class="number">0</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> members;</span><br><span class="line">        &#125;</span><br><span class="line">        Class&lt;?&gt; memberType = members[<span class="number">0</span>].getClass();</span><br><span class="line">        <span class="keyword">if</span> (filteredNames.contains(WILDCARD)) &#123;</span><br><span class="line">            <span class="keyword">return</span> (Member[]) Array.newInstance(memberType, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> numNewMembers = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (Member member : members) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!filteredNames.contains(member.getName())) &#123;</span><br><span class="line">                ++numNewMembers;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Member[] newMembers = (Member[])Array.newInstance(memberType, numNewMembers);</span><br><span class="line">        <span class="keyword">int</span> destIdx = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (Member member : members) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!filteredNames.contains(member.getName())) &#123;</span><br><span class="line">                newMembers[destIdx++] = member;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> newMembers;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Tests if the given method is caller-sensitive and the declaring class</span></span><br><span class="line"><span class="comment">     * is defined by either the bootstrap class loader or platform class loader.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isCallerSensitive</span><span class="params">(Method m)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> ClassLoader loader = m.getDeclaringClass().getClassLoader();</span><br><span class="line">        <span class="keyword">if</span> (VM.isSystemDomainLoader(loader)) &#123;</span><br><span class="line">            <span class="keyword">return</span> m.isAnnotationPresent(CallerSensitive.class);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns an IllegalAccessException with an exception message based on</span></span><br><span class="line"><span class="comment">     * the access that is denied.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IllegalAccessException <span class="title">newIllegalAccessException</span><span class="params">(Class&lt;?&gt; currentClass,</span></span></span><br><span class="line"><span class="params"><span class="function">                                                                   Class&lt;?&gt; memberClass,</span></span></span><br><span class="line"><span class="params"><span class="function">                                                                   Class&lt;?&gt; targetClass,</span></span></span><br><span class="line"><span class="params"><span class="function">                                                                   <span class="keyword">int</span> modifiers)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (currentClass == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">return</span> newIllegalAccessException(memberClass, modifiers);</span><br><span class="line"></span><br><span class="line">        String currentSuffix = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        String memberSuffix = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        Module m1 = currentClass.getModule();</span><br><span class="line">        <span class="keyword">if</span> (m1.isNamed())</span><br><span class="line">            currentSuffix = <span class="string">&quot; (in &quot;</span> + m1 + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">        Module m2 = memberClass.getModule();</span><br><span class="line">        <span class="keyword">if</span> (m2.isNamed())</span><br><span class="line">            memberSuffix = <span class="string">&quot; (in &quot;</span> + m2 + <span class="string">&quot;)&quot;</span>;</span><br><span class="line"></span><br><span class="line">        String memberPackageName = memberClass.getPackageName();</span><br><span class="line"></span><br><span class="line">        String msg = currentClass + currentSuffix + <span class="string">&quot; cannot access &quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (m2.isExported(memberPackageName, m1)) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// module access okay so include the modifiers in the message</span></span><br><span class="line">            msg += <span class="string">&quot;a member of &quot;</span> + memberClass + memberSuffix +</span><br><span class="line">                    <span class="string">&quot; with modifiers \&quot;&quot;</span> + Modifier.toString(modifiers) + <span class="string">&quot;\&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// module access failed</span></span><br><span class="line">            msg += memberClass + memberSuffix+ <span class="string">&quot; because &quot;</span></span><br><span class="line">                   + m2 + <span class="string">&quot; does not export &quot;</span> + memberPackageName;</span><br><span class="line">            <span class="keyword">if</span> (m2.isNamed()) msg += <span class="string">&quot; to &quot;</span> + m1;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> IllegalAccessException(msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns an IllegalAccessException with an exception message where</span></span><br><span class="line"><span class="comment">     * there is no caller frame.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> IllegalAccessException <span class="title">newIllegalAccessException</span><span class="params">(Class&lt;?&gt; memberClass,</span></span></span><br><span class="line"><span class="params"><span class="function">                                                                    <span class="keyword">int</span> modifiers)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        String memberSuffix = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        Module m2 = memberClass.getModule();</span><br><span class="line">        <span class="keyword">if</span> (m2.isNamed())</span><br><span class="line">            memberSuffix = <span class="string">&quot; (in &quot;</span> + m2 + <span class="string">&quot;)&quot;</span>;</span><br><span class="line"></span><br><span class="line">        String memberPackageName = memberClass.getPackageName();</span><br><span class="line"></span><br><span class="line">        String msg = <span class="string">&quot;JNI attached native thread (null caller frame) cannot access &quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (m2.isExported(memberPackageName)) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// module access okay so include the modifiers in the message</span></span><br><span class="line">            msg += <span class="string">&quot;a member of &quot;</span> + memberClass + memberSuffix +</span><br><span class="line">                <span class="string">&quot; with modifiers \&quot;&quot;</span> + Modifier.toString(modifiers) + <span class="string">&quot;\&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// module access failed</span></span><br><span class="line">            msg += memberClass + memberSuffix+ <span class="string">&quot; because &quot;</span></span><br><span class="line">                + m2 + <span class="string">&quot; does not export &quot;</span> + memberPackageName;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> IllegalAccessException(msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns true if &#123;<span class="doctag">@code</span> currentClass&#125; and &#123;<span class="doctag">@code</span> memberClass&#125;</span></span><br><span class="line"><span class="comment">     * are nestmates - that is, if they have the same nesthost as</span></span><br><span class="line"><span class="comment">     * determined by the VM.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="keyword">boolean</span> <span class="title">areNestMates</span><span class="params">(Class&lt;?&gt; currentClass,</span></span></span><br><span class="line"><span class="params"><span class="function">                                              Class&lt;?&gt; memberClass)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="什么是反射"><a href="#什么是反射" class="headerlink" title="什么是反射"></a>什么是反射</h3><ul>
<li>Reflection是Java被视为动态语言的关键，反射机制允许程序在执行期借助于Reflection Api取得任何类的内部信息，并能直接操作任意对象的内部属性及方法。</li>
<li>加载完类之后，在堆内存方法区中就产生了一个Class类型的对象（一个类只有一个Class对象），这个对象就包含了完整的类的结构信息。我们可以通过这个对象看到类的结构。这个对象就像一面镜子，透过这个镜子看到类的结构，所以我们形象的称之为：反射</li>
</ul>
<p><img src="https://i.imgur.com/BynAsxL.png" alt="反射"></p>
<h3 id="简单应用"><a href="#简单应用" class="headerlink" title="简单应用"></a>简单应用</h3><ul>
<li>判断对象所属类</li>
<li>构造任意一个类的对象</li>
<li>任意一个类所具有的成员变量和方法</li>
<li>获取泛型信息</li>
<li>调用任意一个对象的成员变量和方法</li>
<li>处理注解</li>
<li>生成动态代理</li>
</ul>
<h3 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h3><ul>
<li>优点<ul>
<li>可以实现动态创建对象和编译，体现强大的灵活性</li>
</ul>
</li>
<li>缺点<ul>
<li>对性能有影响。使用反射本质上是一种解释操作，我们可以告诉JVM，我们希望做什么并且它满足我们的要求。这类操作总是慢于直接执行相同的操作</li>
</ul>
</li>
</ul>
<h3 id="反射相关的主要Api"><a href="#反射相关的主要Api" class="headerlink" title="反射相关的主要Api"></a>反射相关的主要Api</h3><ul>
<li>java.lang.Class：代表一个类</li>
<li>java.lang.reflect.Method：代表类的方法</li>
<li>java.lang.reflect.FIELD：代表类的成员变量</li>
<li>java.lang.reflect.Constructor：代表类的构造器</li>
<li>……..</li>
</ul>
<h3 id="Class类"><a href="#Class类" class="headerlink" title="Class类"></a>Class类</h3><ul>
<li>Class本身也是一个类</li>
<li>Class对象只能由系统建立对象</li>
<li>一个加载的类在JVM中只会有一个Class实例</li>
<li>一个Class对象对应的是一个加载到JVM中的一个.class文件</li>
<li>每个类的实例都会记得自己是由哪个Class实例所生成的</li>
<li>通过Class可以完整地得到一个类中的所有被加载的结构</li>
<li>Class类是Reflection的根源，针对任何你想动态加载、运行的类，唯有先获取相应的Class对象</li>
</ul>
<h4 id="哪些类型可以有Class对象？"><a href="#哪些类型可以有Class对象？" class="headerlink" title="哪些类型可以有Class对象？"></a>哪些类型可以有Class对象？</h4><ul>
<li>class：外部类，成员(成员内部类，静态内部类)，局部内部类，匿名内部类。</li>
<li>interface：接口</li>
<li>[]：数组</li>
<li>enum：枚举</li>
<li>annotation：注解@interface</li>
<li>primitive type：基本数据类型</li>
<li>void</li>
</ul>
<h4 id="getClass"><a href="#getClass" class="headerlink" title="getClass()"></a>getClass()</h4><p>每个类都继承了Object，Object类中定义了public final Class getClass()，每个类都是被Class加载到内存中，通过getClass()返回所属类</p>
<blockquote>
<p>getClass() returns the runtime class of this Object. The returned Class object is the object that is locked by static synchronized methods of the represented class.</p>
</blockquote>
<blockquote>
<p>Obejct类有一个getClass()方法：返回此 Object 的运行时类。返回的 Class 对象是由所表示类的 static synchronized 方法锁定的对象。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Art</span> </span>&#123;</span><br><span class="line">    	Art() &#123;</span><br><span class="line">        		System.out.println(<span class="string">&quot;Art&quot;</span>);		</span><br><span class="line">        		System.out.println(getClass().getName());	</span><br><span class="line">    	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Drawing</span> <span class="keyword">extends</span> <span class="title">Art</span> </span>&#123;	</span><br><span class="line">    	Drawing() &#123;</span><br><span class="line">        		System.out.println(<span class="string">&quot;Drawing&quot;</span>);		</span><br><span class="line">        		System.out.println(getClass().getName());	</span><br><span class="line">    	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Cartoon</span> <span class="keyword">extends</span> <span class="title">Drawing</span></span>&#123;	</span><br><span class="line">    	Cartoon()&#123;		</span><br><span class="line">        		System.out.println(<span class="string">&quot;Cartoon&quot;</span>);		</span><br><span class="line">       		System.out.println(getClass().getName());	</span><br><span class="line">    &#125;		</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;		</span><br><span class="line">        Cartoon x = <span class="keyword">new</span> Cartoon();				</span><br><span class="line">        Drawing one = (Drawing)x;		</span><br><span class="line">        Art two = (Art)x;		</span><br><span class="line">        <span class="keyword">if</span>(one == two)&#123;			</span><br><span class="line">            System.out.println(<span class="string">&quot;==&quot;</span>);		</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;			</span><br><span class="line">            System.out.println(<span class="string">&quot;!=&quot;</span>);		</span><br><span class="line">        &#125;		</span><br><span class="line">        System.out.println(x.toString());		</span><br><span class="line">        System.out.println(one.toString());		</span><br><span class="line">        System.out.println(two.toString());	&#125;&#125;</span><br><span class="line"><span class="comment">//输出</span></span><br><span class="line">Art</span><br><span class="line">com.cignacmc.knowledge.inheritance.Cartoon</span><br><span class="line">Drawing </span><br><span class="line">com.cignacmc.knowledge.inheritance.Cartoon</span><br><span class="line">Cartoon</span><br><span class="line">com.cignacmc.knowledge.inheritance.Cartoon</span><br><span class="line">==</span><br><span class="line">com.cignacmc.knowledge.inheritance.Cartoon@182f0db</span><br><span class="line">com.cignacmc.knowledge.inheritance.Cartoon@182f0db</span><br><span class="line">com.cignacmc.knowledge.inheritance.Cartoon@182f0db</span><br></pre></td></tr></table></figure>

<p>结论：当调用getClass()时，返回这个对象真实的Class对象。<strong>从3个继承对象相等的情况和输出可知</strong>，这三个对象有相同的this指针，即内存地址一致。<strong>而getClass()返回的就是this指针所代表的最真实的Class的对象，也即最上层的子类。并不是父类。</strong></p>
<h2 id="Java内存分析"><a href="#Java内存分析" class="headerlink" title="Java内存分析"></a>Java内存分析</h2><h3 id="Java内存"><a href="#Java内存" class="headerlink" title="Java内存"></a>Java内存</h3><h4 id="堆"><a href="#堆" class="headerlink" title="堆"></a>堆</h4><ul>
<li>存放new的对象和数组</li>
<li>可以被所有的线程共享，不会存放别的对象引用</li>
</ul>
<h4 id="栈"><a href="#栈" class="headerlink" title="栈"></a>栈</h4><ul>
<li>存放基本变量类型</li>
<li>引用对象的变量</li>
</ul>
<h4 id="方法区"><a href="#方法区" class="headerlink" title="方法区"></a>方法区</h4><ul>
<li>可以被所有的线程共享</li>
<li>包含了所有的class和static变量</li>
</ul>
<h2 id="类的加载过程"><a href="#类的加载过程" class="headerlink" title="类的加载过程"></a>类的加载过程</h2><blockquote>
<p>当程序主动使用某个类时，如果该类未被加载到内存中，则系统会通过下面三个流程加载</p>
</blockquote>
<ul>
<li>类的加载(Loading)：将类的class文件字节码内容读入内存，并为之创建一个java.lang.Class对象。此过程由类的加载器完成。(ClassLoader)</li>
<li>将class文件字节码加载到内存中，并将这些静态数据转换成方法区的运行时数据结构，然后生成一个代表这个累得java.lang.Class对象</li>
<li>类的链接(Linking)：将类的二进制数据合并到JRE中<ul>
<li>验证：确保加载的类信息符合JVM规范，没有安全方面的问题</li>
<li>准备：正式为类变量(static)分配内存并设置类变量默认初始值阶段，这些内存都将在方法区中进行分配。</li>
<li>解析：虚拟机常量池内的符号引用(常量名)替换为直接引用(地址)的过程。</li>
</ul>
</li>
<li>类的初始化(Initializing)：JVM负责对类进行初始化<ul>
<li>执行类构造器&lt;clinit&gt;()方法的过程。类构造器&lt;clinit&gt;()方法是由编译器自动收集类中所有类变量的赋值动作和静态代码快中的语句合并产生的。(类构造器是构造信息的，不是构造该类对象的构造器)。</li>
<li>当初始化一个类的时候，如果发现其父类还没有进行初始化，则需要先出发其父类的初始化。</li>
<li>虚拟机会保证一个类的&lt;clinit&gt;()方法在多线程环境中被正确枷锁和同步。</li>
</ul>
</li>
</ul>
<h2 id="什么时候会发生类的初始化"><a href="#什么时候会发生类的初始化" class="headerlink" title="什么时候会发生类的初始化"></a>什么时候会发生类的初始化</h2><h3 id="类的主动引用-一定会发生类的初始化"><a href="#类的主动引用-一定会发生类的初始化" class="headerlink" title="类的主动引用(一定会发生类的初始化)"></a>类的主动引用(一定会发生类的初始化)</h3><ul>
<li>当虚拟机启动，先初始化main方法所在的类</li>
<li>new一个类的对象</li>
<li>调用类的静态成员(除final常量)和静态方法</li>
<li>使用java.lang.reflect包的方法对类进行反射调用</li>
<li>当初始化一个类，如果其父类没有被初始化，则先会初始化它的父类</li>
</ul>
<h3 id="类的被动引用-不会发生类的初始化"><a href="#类的被动引用-不会发生类的初始化" class="headerlink" title="类的被动引用(不会发生类的初始化)"></a>类的被动引用(不会发生类的初始化)</h3><ul>
<li>当访问一个静态域时，只有真正声明这个域的类才会被初始化。如：当通过子类引用父类的静态变量，不会导致子类的初始化</li>
<li>通过数组定义类引用，不会出发次类的初始化</li>
<li>引用常量不会出发累得初始化(常量在链接阶段久存如调用类的常量池中了)</li>
</ul>
<h2 id="类加载器的作用"><a href="#类加载器的作用" class="headerlink" title="类加载器的作用"></a>类加载器的作用</h2><h3 id="类加载的作用："><a href="#类加载的作用：" class="headerlink" title="类加载的作用："></a>类加载的作用：</h3><ul>
<li>将class文件字节码内容加载到内存中，并将这些静态数据转换成方法去的运行时数据结构，然后在堆中生成一个代表着各类的java.lang.Class对象，作为方法去中类数据的访问入口。</li>
</ul>
<h3 id="类缓存："><a href="#类缓存：" class="headerlink" title="类缓存："></a>类缓存：</h3><ul>
<li>标准的Java SE类加载器可以按照要求查找类，但一旦某个类被加载到类加载器中，它将维持加载(缓存)一段时间。不过JVM垃圾回收机制可以回收这个Class对象。</li>
</ul>
<p><img src="https://i.imgur.com/wEyTOiL.png" alt="Java文件处理过程"></p>
<p><img src="https://i.imgur.com/lhvu05w.png" alt="Java8类加载器"></p>
<p><em>However 在<code>Java9</code>中：</em></p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/9/docs/api/java/lang/ClassLoader.html">quote</a></p>
<h3 id="Run-time-Built-in-Class-Loaders"><a href="#Run-time-Built-in-Class-Loaders" class="headerlink" title="Run-time Built-in Class Loaders"></a>Run-time Built-in Class Loaders</h3><p>The Java run-time has the following built-in class loaders:</p>
<ul>
<li><p>Bootstrap class loader. It is the virtual machine’s built-in class loader, typically represented as <code>null</code>, and does not have a parent.</p>
<p><em>引导类加载器。JVM内置类加载器，通常情况下返回null并且无父类。</em></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/9/docs/api/java/lang/ClassLoader.html#getPlatformClassLoader--">Platform class loader</a>. All <em>platform classes</em> are visible to the platform class loader that can be used as the parent of a <code>ClassLoader</code> instance. Platform classes include Java SE platform APIs, their implementation classes and JDK-specific run-time classes that are defined by the platform class loader or its ancestors.</p>
<p><em>平台类加载器。所有平台类都对平台类加载器可见并且可以作为ClassLoader实例的父类。平台类包括Java SE platform Api、他们的实现类和一些平台类或者祖先定义的JDK-specific运行类。</em></p>
<p>To allow for upgrading/overriding of modules defined to the platform class loader, and where upgraded modules read modules defined to class loaders other than the platform class loader and its ancestors, then the platform class loader may have to delegate to other class loaders, the application class loader for example. In other words, classes in named modules defined to class loaders other than the platform class loader and its ancestors may be visible to the platform class loader.</p>
<p><em>为了允许升级和重写平台类加载器定义的模块，以及已升级的模块读取除了平台类或其祖先为了类加载器而定义的模块，于是平台类加载器应该要委托其它类加载器，比如应用类加载器。换句话来说，一些除了平台类加载器和其祖先为类加载器定义的已命名模块应该对平台类加载器可见。</em></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/9/docs/api/java/lang/ClassLoader.html#getSystemClassLoader--">System class loader</a>. It is also known as <em>application class loader</em> and is distinct from the platform class loader. The system class loader is typically used to define classes on the application class path, module path, and JDK-specific tools. The platform class loader is a parent or an ancestor of the system class loader that all platform classes are visible to it.</p>
<p><em>系统类加载器。亦称<strong>应用加载器</strong>，它有别于平台类加载器。系统类加载器通常用于定义在应用类路径、模块路径和JDk专用工具上的类，。平台类加载器是系统类加载器的一个父类或者祖先类，同时所有平台类都对系统类加载器可见。</em> </p>
</li>
</ul>
</blockquote>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/9/migrate/toc.htm#JSMIG-GUID-A868D0B9-026F-4D46-B979-901834343F9E">migration guide</a></p>
<h3 id="New-Class-Loader-Implementations"><a href="#New-Class-Loader-Implementations" class="headerlink" title="New Class Loader Implementations"></a>New Class Loader Implementations</h3><p>JDK 9 maintains the hierarchy of class loaders that existed since the 1.2 release. However, the following changes have been made to implement the module system:</p>
<ul>
<li><p>The application class loader is no longer an instance of URLClassLoader but, rather, of an internal class. It is the default loader for classes in modules that are neither Java SE nor JDK modules.</p>
<p><em>应用类加载器不再是<code>URLClassLoader</code> 的实例，而更去作为一个内部类。是一个非Java SE和JDK模块的默认类加载器。</em></p>
</li>
<li><p>The extension class loader has been renamed; it is now the platform class loader. All classes in the Java SE Platform are guaranteed to be visible through the platform class loader. In addition, the classes in modules that are standardized under the Java Community Process but not part of the Java SE Platform are guaranteed to be visible through the platform class loader.</p>
<p><em>拓展类加载器已经被重命名为平台类加载器。所有的Java SE平台的类都必须对平台类加载器可见。另外，在Java社区进程标准化并且不是Java SE平台的类也必须对平台类加载器可见。</em></p>
<p>Just because a class is visible through the platform class loader does not mean the class is actually defined by the platform class loader. Some classes in the Java SE Platform are defined by the platform class loader while others are defined by the bootstrap class loader. Applications should not depend on which class loader defines which platform class.</p>
<p><em>正因为当一个类对平台类可见不代表它将是由平台类加载器定义的。有一些Java SE平台定义的是由平台类加载器定义的而另一些则是由引导类加载器定义的。应用不应该依赖于哪个类加载器定义了平台类。</em></p>
<p>The changes in JDK 9 may impact code that creates class loaders with <code>null</code> (that is, the bootstrap class loader) as the parent class loader and assumes that all platform classes are visible to the parent. Such code may need to be changed to use the platform class loader as the parent (see <a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/9/docs/api/java/lang/ClassLoader.html#getPlatformClassLoader--">ClassLoader.getPlatformClassLoader</a>).</p>
<p><em>JDK9的改变可能会给以类引导类加载器作为父类并且认为所有平台类都对父类可见的代码带来一定冲击，这样的代码可能需要重新将平台类加载器作为父类。</em></p>
<p>The platform class loader is not an instance of URLClassLoader, but, rather, of an internal class.</p>
<p><em>平台类加载器不再是<code>URLClassLoader</code> 的实例，而更去作为一个内部类。</em></p>
</li>
<li><p>The bootstrap class loader is still built-in to the Java Virtual Machine and represented by <code>null</code> in the ClassLoader API. It defines the classes in a handful of critical modules, such as java.base. As a result, it defines far fewer classes than in JDK 8, so applications that are deployed with <code>-Xbootclasspath/a</code> or that create class loaders with <code>null</code> as the parent may need to change as described previously.</p>
<p><em>引导类加载器仍然是JVM的内置类加载器并且作为null值在类加载器API中。它定义了一堆比较危险的模块，比如java.base。这造成了它定义的类相较于JDK8少很多，所以一些以 <code>-Xbootclasspath/a</code>或者一些创建类加载器以null作为父类的类可能需要像上述那样修改类。</em></p>
</li>
</ul>
<p>See <a target="_blank" rel="noopener" href="http://www.oracle.com/technetwork/java/javase/9-relnotes-3622618.html">JDK 9 Release Notes</a>.</p>
</blockquote>
<h2 id="获取运行时类的完整结构"><a href="#获取运行时类的完整结构" class="headerlink" title="获取运行时类的完整结构"></a>获取运行时类的完整结构</h2><h3 id="通过反射获取运行时类的完整结构："><a href="#通过反射获取运行时类的完整结构：" class="headerlink" title="通过反射获取运行时类的完整结构："></a>通过反射获取运行时类的完整结构：</h3><p>Field、Method、Constructor、Superclass、Interface、Annotation</p>
<ul>
<li>实现的全部接口</li>
<li>所继承的父类</li>
<li>全部的构造器</li>
<li>全部的方法</li>
<li>全部的Field</li>
<li>注解</li>
<li>。。。</li>
</ul>
<h3 id="小结："><a href="#小结：" class="headerlink" title="小结："></a>小结：</h3><ul>
<li>在实际操作中，取得类的信息的操作代码，并不会经常开发</li>
<li>一定要熟悉java.lang.reflect包而作用，反射机制。</li>
<li>如何取得属性、方法、构造器的名称，修饰符等。</li>
</ul>
<h2 id="有了Class对象，能做什么？"><a href="#有了Class对象，能做什么？" class="headerlink" title="有了Class对象，能做什么？"></a>有了Class对象，能做什么？</h2><ul>
<li>创建类的对象：调用Class对象的newInstance()方法<ul>
<li>类必须有一个无参构造</li>
<li>类的构造器的访问权限需要足够</li>
</ul>
</li>
</ul>
<p>Thinking：难道没有午餐的构造器就不能创建对象了吗？只要在操作的时候明确的调用类中的构造器，并将参数传递进去之后，才能实例化操作。</p>
<ul>
<li>Steps：<ul>
<li>通过Class类的getDeclaredConstructor(Class … parameterTypes)取得本类指定形参类型的构造器</li>
<li>向构造器的形参中传递一个对象数组进去，里面包含了构造器中所需的各个参数。</li>
<li>通过Constructor实例化对象</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Reflect2Instance</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// 获取对象并实例化给Class</span></span><br><span class="line">        Class&lt;?&gt; cl = Class.forName(<span class="string">&quot;entity.Proxy&quot;</span>);</span><br><span class="line">        Proxy proxy = <span class="keyword">new</span> Proxy(<span class="string">&quot;localhost&quot;</span>, <span class="number">7890</span>, <span class="keyword">new</span> String[]&#123;<span class="string">&quot;&quot;</span>&#125;, <span class="string">&quot;http&quot;</span>, <span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">// clazz.newInstance()已经被弃用，此处使用clazz.getDeclaredConstructor().newInstance()。getDeclaredConstructor()获取指定构造器，newInstance()新建实例。</span></span><br><span class="line">        Object obj = cl.getDeclaredConstructor(</span><br><span class="line">                String.class,</span><br><span class="line">                <span class="keyword">int</span>.class,</span><br><span class="line">                String[].class,</span><br><span class="line">                String.class,</span><br><span class="line">                Boolean.class</span><br><span class="line">        ).newInstance(<span class="string">&quot;localhost&quot;</span>, <span class="number">7890</span>, <span class="keyword">new</span> String[]&#123;<span class="string">&quot;&quot;</span>&#125;, <span class="string">&quot;socks5&quot;</span>, <span class="keyword">false</span>);</span><br><span class="line">        System.out.println(obj.toString());</span><br><span class="line">        System.out.println(obj.hashCode());</span><br><span class="line">        System.out.println(proxy);</span><br><span class="line">        <span class="comment">// 调用方法注入内容</span></span><br><span class="line">        cl.getDeclaredMethod(<span class="string">&quot;setProxyIp&quot;</span>, String.class).invoke(proxy, <span class="string">&quot;192.168.123.81&quot;</span>);</span><br><span class="line">        System.out.println(proxy);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="调用制定的方法"><a href="#调用制定的方法" class="headerlink" title="调用制定的方法"></a>调用制定的方法</h3><p>通过反射调用类中的方法，通过Method类完成。</p>
<ol>
<li>通过Class类的getMethod(String name, Class … parameterTypes)方法取得一个Method对象，并设置此方法操作时所需要的参数类型。</li>
<li>之后使用Object invoke(Object obj, Object[] args)进行调用，并向方法中传递要设置的obj对象的参数信息。</li>
</ol>
<p><img src="https://i.imgur.com/2yV9miO.png" alt="过程"></p>
<p><code>Object invoke(Object obj, Object ... args)</code></p>
<ul>
<li>Object对应原方法的返回值，若原方法无返回值，此时返回null</li>
<li>若原方法若为静态方法，此时形参Object obj可谓null</li>
<li>若原方法形参列表为空，则Object[]  args为null</li>
<li>若原方法声明为private，则需要在调用此invoke()方法前，显式调用方法对象的setAccessible(true)方法，将可访问private的方法。</li>
</ul>
<p><code>setAccessible()</code></p>
<ul>
<li>Method和Field、Constructor对象都有setAccessible()方法</li>
<li>setAccessible作用是启动和禁用访问安全检查的开关。</li>
<li>参数值为true则只是反射的对象在使用时应该取消Java语言的访问检查。<ul>
<li>提高反射的效率。如果代码中必须用反射，而该句代码需要频繁的被调用，那么请设置为true。</li>
<li>使得原本无法访问的私有成员可以访问</li>
</ul>
</li>
<li>参数值为false则只是反射的对象应该实施Java语言访问检查。</li>
</ul>
<h2 id="反射操作泛型"><a href="#反射操作泛型" class="headerlink" title="反射操作泛型"></a>反射操作泛型</h2><ul>
<li>Java采用泛型擦除的机制来引入泛型，Java钟的繁星仅仅是给编译器javac使用的，确保数据的安全性和免去强制类型转换问题，但是，一旦编译完成，所有和泛型有关的类型全部擦除</li>
<li>为了用过反射操作这些类型，Java新增了ParameterizedType，GenericArrayType，TypeVariable和WildcardType几种类型来代表不能被归一到Class类中的类型但是又何原始类型齐名的类型。</li>
<li>ParameterizedType：表示一种参数化类型，比如Collection&lt;String&gt;</li>
<li>GenericArrayType：表示一种元素类型是参数化类型或者类型变量的数组类型</li>
<li>TypeVariable：是各种类型变量的公共接口</li>
<li>WildcardType：代表一种通配符类型表达式</li>
</ul>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a target="_blank" rel="noopener" href="http://github.com/ReadChart">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Java-SE-Annotation-amp-Reflection"><span class="toc-number">1.</span> <span class="toc-text">Java SE: Annotation &amp; Reflection</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3"><span class="toc-number"></span> <span class="toc-text">注解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.</span> <span class="toc-text">什么是注解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E7%BD%AE%E6%B3%A8%E8%A7%A3"><span class="toc-number">2.</span> <span class="toc-text">内置注解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%83%E6%B3%A8%E8%A7%A3"><span class="toc-number">3.</span> <span class="toc-text">元注解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3"><span class="toc-number">4.</span> <span class="toc-text">自定义注解</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8D%E5%B0%84"><span class="toc-number"></span> <span class="toc-text">反射</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%8F%8D%E5%B0%84"><span class="toc-number">1.</span> <span class="toc-text">什么是反射</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E5%BA%94%E7%94%A8"><span class="toc-number">2.</span> <span class="toc-text">简单应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-number">3.</span> <span class="toc-text">优缺点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E5%B0%84%E7%9B%B8%E5%85%B3%E7%9A%84%E4%B8%BB%E8%A6%81Api"><span class="toc-number">4.</span> <span class="toc-text">反射相关的主要Api</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Class%E7%B1%BB"><span class="toc-number">5.</span> <span class="toc-text">Class类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%93%AA%E4%BA%9B%E7%B1%BB%E5%9E%8B%E5%8F%AF%E4%BB%A5%E6%9C%89Class%E5%AF%B9%E8%B1%A1%EF%BC%9F"><span class="toc-number">5.1.</span> <span class="toc-text">哪些类型可以有Class对象？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#getClass"><span class="toc-number">5.2.</span> <span class="toc-text">getClass()</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Java%E5%86%85%E5%AD%98%E5%88%86%E6%9E%90"><span class="toc-number"></span> <span class="toc-text">Java内存分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Java%E5%86%85%E5%AD%98"><span class="toc-number">1.</span> <span class="toc-text">Java内存</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A0%86"><span class="toc-number">1.1.</span> <span class="toc-text">堆</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%88"><span class="toc-number">1.2.</span> <span class="toc-text">栈</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E5%8C%BA"><span class="toc-number">1.3.</span> <span class="toc-text">方法区</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B1%BB%E7%9A%84%E5%8A%A0%E8%BD%BD%E8%BF%87%E7%A8%8B"><span class="toc-number"></span> <span class="toc-text">类的加载过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E4%BC%9A%E5%8F%91%E7%94%9F%E7%B1%BB%E7%9A%84%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number"></span> <span class="toc-text">什么时候会发生类的初始化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E7%9A%84%E4%B8%BB%E5%8A%A8%E5%BC%95%E7%94%A8-%E4%B8%80%E5%AE%9A%E4%BC%9A%E5%8F%91%E7%94%9F%E7%B1%BB%E7%9A%84%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">1.</span> <span class="toc-text">类的主动引用(一定会发生类的初始化)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E7%9A%84%E8%A2%AB%E5%8A%A8%E5%BC%95%E7%94%A8-%E4%B8%8D%E4%BC%9A%E5%8F%91%E7%94%9F%E7%B1%BB%E7%9A%84%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">2.</span> <span class="toc-text">类的被动引用(不会发生类的初始化)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number"></span> <span class="toc-text">类加载器的作用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E5%8A%A0%E8%BD%BD%E7%9A%84%E4%BD%9C%E7%94%A8%EF%BC%9A"><span class="toc-number">1.</span> <span class="toc-text">类加载的作用：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E7%BC%93%E5%AD%98%EF%BC%9A"><span class="toc-number">2.</span> <span class="toc-text">类缓存：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Run-time-Built-in-Class-Loaders"><span class="toc-number">3.</span> <span class="toc-text">Run-time Built-in Class Loaders</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#New-Class-Loader-Implementations"><span class="toc-number">4.</span> <span class="toc-text">New Class Loader Implementations</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E8%BF%90%E8%A1%8C%E6%97%B6%E7%B1%BB%E7%9A%84%E5%AE%8C%E6%95%B4%E7%BB%93%E6%9E%84"><span class="toc-number"></span> <span class="toc-text">获取运行时类的完整结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E5%8F%8D%E5%B0%84%E8%8E%B7%E5%8F%96%E8%BF%90%E8%A1%8C%E6%97%B6%E7%B1%BB%E7%9A%84%E5%AE%8C%E6%95%B4%E7%BB%93%E6%9E%84%EF%BC%9A"><span class="toc-number">1.</span> <span class="toc-text">通过反射获取运行时类的完整结构：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93%EF%BC%9A"><span class="toc-number">2.</span> <span class="toc-text">小结：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%89%E4%BA%86Class%E5%AF%B9%E8%B1%A1%EF%BC%8C%E8%83%BD%E5%81%9A%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number"></span> <span class="toc-text">有了Class对象，能做什么？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%83%E7%94%A8%E5%88%B6%E5%AE%9A%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-number">1.</span> <span class="toc-text">调用制定的方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8D%E5%B0%84%E6%93%8D%E4%BD%9C%E6%B3%9B%E5%9E%8B"><span class="toc-number"></span> <span class="toc-text">反射操作泛型</span></a>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://readchart.github.io/2021/03/03/Java%E6%B3%A8%E8%A7%A3%E4%B8%8E%E5%8F%8D%E5%B0%84/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://readchart.github.io/2021/03/03/Java%E6%B3%A8%E8%A7%A3%E4%B8%8E%E5%8F%8D%E5%B0%84/&text=Java注解与反射"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://readchart.github.io/2021/03/03/Java%E6%B3%A8%E8%A7%A3%E4%B8%8E%E5%8F%8D%E5%B0%84/&title=Java注解与反射"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://readchart.github.io/2021/03/03/Java%E6%B3%A8%E8%A7%A3%E4%B8%8E%E5%8F%8D%E5%B0%84/&is_video=false&description=Java注解与反射"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Java注解与反射&body=Check out this article: https://readchart.github.io/2021/03/03/Java%E6%B3%A8%E8%A7%A3%E4%B8%8E%E5%8F%8D%E5%B0%84/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://readchart.github.io/2021/03/03/Java%E6%B3%A8%E8%A7%A3%E4%B8%8E%E5%8F%8D%E5%B0%84/&title=Java注解与反射"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://readchart.github.io/2021/03/03/Java%E6%B3%A8%E8%A7%A3%E4%B8%8E%E5%8F%8D%E5%B0%84/&title=Java注解与反射"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://readchart.github.io/2021/03/03/Java%E6%B3%A8%E8%A7%A3%E4%B8%8E%E5%8F%8D%E5%B0%84/&title=Java注解与反射"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://readchart.github.io/2021/03/03/Java%E6%B3%A8%E8%A7%A3%E4%B8%8E%E5%8F%8D%E5%B0%84/&title=Java注解与反射"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://readchart.github.io/2021/03/03/Java%E6%B3%A8%E8%A7%A3%E4%B8%8E%E5%8F%8D%E5%B0%84/&name=Java注解与反射&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://readchart.github.io/2021/03/03/Java%E6%B3%A8%E8%A7%A3%E4%B8%8E%E5%8F%8D%E5%B0%84/&t=Java注解与反射"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2021
    Richard T
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a target="_blank" rel="noopener" href="http://github.com/ReadChart">Projects</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->

<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">


<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">


    <!-- jquery -->

<script src="/lib/jquery/jquery.min.js"></script>


<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>

<!-- clipboard -->

  
<script src="/lib/clipboard/clipboard.min.js"></script>

  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-173531821-1', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Baidu Analytics -->

<!-- Disqus Comments -->


</body>
</html>
